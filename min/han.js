jQuery.noConflict(),function($){var version="2.1.0",tests=[],rubies,unicode=[],rendered="han-js-rendered",classes=[rendered],fontfaces=[],han=function(){$(document).on("ready",function(){fontfaces.songti=test_for_fontface("Han Songti"),fontfaces.kaiti=test_for_fontface("Han Kaiti"),fontfaces.fangsong=test_for_fontface("Han Fangsong");for(var font in fontfaces)classes.push((fontfaces[font]?"":"no-")+"fontface-"+font);$("html").addClass(classes.join(" ")),init()})},init=function(range){if(range||!$("html").hasClass("no-han-init")){var range=range||"body";"body"===range||$(range).hasClass(rendered)?"body"!==range||$("html").hasClass(rendered)||$("html").addClass(rendered):$(range).addClass(rendered),$(range).find("ruby.pinyin").addClass("romanization"),$(range).find("ruby.zhuyin").addClass("mps"),$(range).find("ruby").each(function(){var html=$(this).html();if($(this).hasClass("mps")||tests.ruby()){if($(this).hasClass("mps")){var generic=$(this).css("font-family"),zhuyin_font=generic.match(/(sans-serif|monospace)$/)?"sans-serif":"serif",hanzi=unicode_set("hanzi"),shengmu=unicode.bopomofo.mps.shengmu,jieyin=unicode.bopomofo.mps.jieyin,yunmu=unicode.bopomofo.mps.yunmu,tone=unicode.bopomofo.tone.five,reg="/("+hanzi+")<rt>(.*)<\\/rt>/ig";html=html.replace(eval(reg),function(entire,character,mps){var form,yin,diao,data,zi;return form=mps.match(eval("/("+shengmu+")/"))?"shengmu":"",form+=mps.match(eval("/("+jieyin+")/"))?(""!==form?"-":"")+"jieyin":"",form+=mps.match(eval("/("+yunmu+")/"))?(""!==form?"-":"")+"yunmu":"",yin=mps.replace(eval("/("+tone+")/g"),""),diao=mps.match(/([\u02D9])/)?"0":mps.match(/([\u02CA])/)?"2":mps.match(/([\u02C5\u02C7])/)?"3":mps.match(/([\u02CB])/)?"4":"1",data='data-zy="'+yin+'" data-tone="'+diao+'" data-form="'+form+'"',zi='<span class="zi" '+data+">"+character+"</span>",zi+'<span class="zy">'+mps+"</span>"}),$(this).replaceWith($('<span class="han-js-zhuyin-rendered"></span>').addClass("zhuyin-"+zhuyin_font).html(html))}}else{var result=html.replace(/<rt>/gi,'</span><span class="rt"><span class="rt inner">').replace(/<\/rt>/gi,'</span></span></span><span class="rr"><span class="rb">');$(this).html('<span class="rr"><span class="rb">'+result+"</span>")}}),$("html").hasClass("han-la")&&$(range).each(function(){var hanzi=unicode_set("hanzi"),latin=unicode_set("latin")+"|"+unicode.punc[0],punc=unicode.punc;patterns=["/("+hanzi+")("+latin+"|"+punc[1]+")/ig","/("+latin+"|"+punc[2]+")("+hanzi+")/ig"],replaceFn=function(){return function(fill){var span=_span("hanla");return span.setAttribute("data-text-before",fill),span}},patterns.forEach(function(exp){findAndReplaceDOMText(eval(exp),this,replaceFn(),1),$(this).find("span.hanla[data-text-before]").each(function(){var char=$(this).attr("data-text-before"),parent=this.parentNode;parent.insertBefore(document.createTextNode(char),this),$(this).removeAttr("data-text-before"),parent.normalize()})},this),$("* > span.hanla:last-child").parent().each(function(){1==this.lastChild.nodeType&&($(this).after($('<span class="hanla"></span>')),$(this).find("span.hanla:last-child").remove())})}),$("html").hasClass("han-lab-underline")?$(range).find("u").charize("",!0,!0):$(range).each(function(){var html=$(this).html();$(this).html(html.replace(/<\/u>(<!--.*?-->|<wbr[ ]?[\/]?>)*?<u(\s.*?)*?>/gi,"</u>$1<u data-adjacent $2>")).find("u[data-adjacent]").addClass("adjacent").removeAttr("data-adjacent")}),$(range).find("em").charize({latin:tests.textemphasis()?"none":"individual"}),tests.quotes()||$(range).find("q q").each(function(){0!=$(this).parents("q").length%2&&$(this).addClass("double")})}},unicode_set=function(set){var join=set.match(/[hanzi|latin]/)?!0:!1,result=join?unicode[set].join("|"):unicode[set];return result},_span=function(className){var span=document.createElement("span");return span.className=className,span},findAndReplaceDOMText=function(exp,node,repNode,cG){return window.findAndReplaceDOMText(exp,node,repNode,cG||null,function(el){var name=el.nodeName.toLowerCase(),classes=1==el.nodeType?el.getAttribute("class"):"",charized=classes&&null!=classes.match(/han-js-charized/)?!0:!1;return"style"!==name&&"script"!==name&&!charized})},inject_element_with_styles=function(rule,callback){var style,ret,docOverflow,docElement=document.documentElement,div=document.createElement("div"),body=document.body,fakeBody=body||document.createElement("body");return style=['<style id="han-support">',rule,"</style>"].join(""),(body?div:fakeBody).innerHTML+=style,fakeBody.appendChild(div),body||(fakeBody.style.background="",fakeBody.style.overflow="hidden",docOverflow=docElement.style.overflow,docElement.style.overflow="hidden",docElement.appendChild(fakeBody)),ret=callback(div,rule),body?div.parentNode.removeChild(div):(fakeBody.parentNode.removeChild(fakeBody),docElement.style.overflow=docOverflow),!!ret},write_on_canvas=function(text,font){var canvasNode=document.createElement("canvas");canvasNode.width="50",canvasNode.height="20",canvasNode.style.display="none",canvasNode.className="han_support_tests",document.body.appendChild(canvasNode);var ctx=canvasNode.getContext("2d");return ctx.textBaseline="top",ctx.font="15px "+font+", sans-serif",ctx.fillStyle="black",ctx.strokeStyle="black",ctx.fillText(text,0,0),ctx},test_for_fontface=function(font){if(!tests.fontface())return!1;try{for(var support,sans=write_on_canvas("Ëæ≠Q","sans-serif"),test=write_on_canvas("Ëæ≠Q",font),j=1;20>=j;j++)for(var i=1;50>=i;i++){var sansData=sans.getImageData(i,j,1,1).data,testData=test.getImageData(i,j,1,1).data,alpha=[];if(alpha.sans=sansData[3],alpha.test=testData[3],"undefined"!==support&&alpha.test!=alpha.sans)support=!0;else if(support)break;20==i&&20==j&&(support||(support=!1))}return $("canvas.han_support_tests").remove(),support}catch(err){return!1}};unicode.latin=["[A-Za-z0-9√Ä-√øƒÄ-≈ø∆Ä-…è·∏Ä-·ªø]"],unicode.punc=["[@&;=_,.?!$%^*-+/]","[(\\['\"<‚Äò‚Äú]","[)\\]'\">‚Äù‚Äô]"],unicode.hanzi=["[‰∏Ä-Èøø]","[„êÄ-‰∂µÈæ¶-ÈæªÔ©∞-Ô´ôÈæº-ÈøÉ„Äá„ÅÄ-„Çû„Ç°-„É∫„ÉΩ„Éæ]","[Ì°Ä-Ì°®][Ì∞Ä-Ìøø]|Ì°©[Ì∞Ä-Ìªü]","Ì°≠[Ì∞Ä-Ìºø]|[Ì°™-Ì°¨][Ì∞Ä-Ìøø]|Ì°©[ÌºÄ-Ìøø]","Ì°≠[ÌΩÄ-Ìøø]|Ì°Æ[Ì∞Ä-Ì∞ü]","[„áÄ-„á£]"],unicode.biaodian=["[¬∑„ÉªÔ∏∞„ÄÅÔºå„ÄÇÔºöÔºõÔºüÔºÅ‚Äî„Éº‚ãØ‚Ä¶Ôºé¬∑Ôºè]","[„Äå„ÄéÔºà„Äî„Äê„Ää„Äà‚Äú‚Äò]","[„Äç„ÄèÔºâ„Äï„Äë„Äã„Äâ‚Äô‚Äù]"],unicode.bopomofo=[],unicode.bopomofo.mps=[],unicode.bopomofo.mps[0]="[„ÑÖ-„Ñ≠]",unicode.bopomofo.mps.shengmu="[„ÑÖ-„Ñô„Ñ™-„Ñ¨]",unicode.bopomofo.mps.jieyin="[„Ñß-„Ñ©]",unicode.bopomofo.mps.yunmu="[„Ñö-„Ñ¶„Ñ≠]",unicode.bopomofo.extend="[„Ü†-„Ü∫]",unicode.bopomofo.tone=[],unicode.bopomofo.tone.five="[ÀôÀäÀÖÀáÀã]",unicode.bopomofo.tone.extend="[À™À´]",tests.columnwidth=function(){var cw=$('<div style="display: none; column-width: 200px; -webkit-column-width: 200px;">tester</div>'),bool=/^200px$/.test(cw.css("-webkit-column-width"))||/^200px$/.test(cw.css("-moz-column-width"))||/^200px$/.test(cw.css("-ms-column-width"))||/^200px$/.test(cw.css("column-width"))?!0:!1;return bool},tests.fontface=function(){var bool;return inject_element_with_styles('@font-face {font-family:"font";src:url("https://")}',function(node,rule){var style=document.getElementById("han-support"),sheet=style.sheet||style.styleSheet,cssText=sheet?sheet.cssRules&&sheet.cssRules[0]?sheet.cssRules[0].cssText:sheet.cssText||"":"";bool=/src/i.test(cssText)&&0===cssText.indexOf(rule.split(" ")[0])}),bool},tests.ruby=function(){function getStyle(element,styleProperty){var result;return window.getComputedStyle?result=document.defaultView.getComputedStyle(element,null).getPropertyValue(styleProperty):element.currentStyle&&(result=element.currentStyle[styleProperty]),result}if(null!=rubies)return rubies;var ruby=document.createElement("ruby"),rt=document.createElement("rt"),rp=document.createElement("rp"),docElement=document.documentElement,displayStyleProperty="display";return ruby.appendChild(rp),ruby.appendChild(rt),docElement.appendChild(ruby),rubies="none"==getStyle(rp,displayStyleProperty)||"ruby"==getStyle(ruby,displayStyleProperty)&&"ruby-text"==getStyle(rt,displayStyleProperty)?!0:!1,docElement.removeChild(ruby),ruby=null,rt=null,rp=null,rubies},tests.textemphasis=function(){var em=$('<span style="display: none; text-emphasis: dot; -moz-text-emphasis: dot; -ms-text-emphasis: dot; -webkit-text-emphasis: dot;">tester</span>'),bool=/^dot$/.test(em.css("-webkit-text-emphasis-style"))||/^dot$/.test(em.css("text-emphasis-style"))||/^dot$/.test(em.css("-moz-text-emphasis-style"))||/^dot$/.test(em.css("-ms-text-emphasis-style"))?!0:!1;return bool},tests.quotes=function(){var q=$("<q style=\"display: none; quotes: '‚Äú' '‚Äù' '‚Äò' '‚Äô'\">tester</q>"),bool=/^"‚Äú" "‚Äù" "‚Äò" "‚Äô"$/.test(q.css("quotes"));return bool},tests.writingmode=function(){var wm=$('<div style="display: none; writing-mode: tb-rl; -moz-writing-mode: tb-rl; -ms-writing-mode: tb-rl; -webkit-writing-mode: vertical-rl;">tester</div>'),bool=/^tb-rl$/.test(wm.css("writing-mode"))||/^vertical-rl$/.test(wm.css("-webkit-writing-mode"))||/^tb-rl$/.test(wm.css("-moz-writing-mode"))||/^tb-rl$/.test(wm.css("-ms-writing-mode"))?!0:!1;return bool},$.fn.extend({hanInit:function(){return init(this)},bitouwei:function(){return this.each(function(){$(this).addClass("han-js-bitouwei-rendered");var tou=unicode.biaodian[0]+unicode.biaodian[2],wei=unicode.biaodian[1],start=unicode.punc[0]+unicode.punc[2],end=unicode.punc[1];tou=tou.replace(/\]\[/g,""),start=start.replace(/\]\[/g,""),findAndReplaceDOMText(eval("/("+wei+")("+unicode_set("hanzi")+")("+tou+")/ig"),this,_span("bitouwei bitouweidian")),findAndReplaceDOMText(eval("/("+unicode_set("hanzi")+")("+tou+")/ig"),this,_span("bitouwei bitoudian")),findAndReplaceDOMText(eval("/("+wei+")("+unicode_set("hanzi")+")/ig"),this,_span("bitouwei biweidian")),findAndReplaceDOMText(eval("/("+end+")("+unicode_set("latin")+"+)("+start+")/ig"),this,_span("bitouwei bitouweidian")),findAndReplaceDOMText(eval("/("+unicode_set("latin")+"+)("+start+")/ig"),this,_span("bitouwei bitoudian")),findAndReplaceDOMText(eval("/("+end+")("+unicode_set("latin")+"+)/ig"),this,_span("bitouwei biweidian"))})},charize:function(glyph,charClass,innerSpan){var glyph=glyph||{},charClass=1==charClass?!0:!1;return glyph={cjk:glyph.cjk||"individual",bitouwei:0==glyph.bitouwei?!1:!0,latin:glyph.latin||"group"},this.each(function(){glyph.bitouwei&&$(this).bitouwei(),"individual"===glyph.cjk&&findAndReplaceDOMText(eval("/("+unicode_set("hanzi")+")/ig"),this,_span("char cjk")),("individual"===glyph.cjk||"biaodian"===glyph.cjk)&&findAndReplaceDOMText(eval("/("+unicode_set("biaodian")+")/ig"),this,_span("char cjk biaodian")),"group"===glyph.cjk&&findAndReplaceDOMText(eval("/("+unicode_set("hanzi")+"+|"+unicode_set("biaodian")+"+)/ig"),this,_span("char cjk"));var latin_regex="group"===glyph.latin?"/("+unicode_set("latin")+"+)/ig":"/("+unicode_set("latin")+")/ig";findAndReplaceDOMText(eval(latin_regex),this,_span("char latin")),findAndReplaceDOMText(eval("/("+unicode_set("punc")+"+)/ig"),this,_span("char latin punc")),findAndReplaceDOMText(/([\s]+)/gi,this,_span("char space")),innerSpan&&$(this).find(".char").each(function(){$(this).html($("<span>").text($(this).text()))}),charClass&&$(this).addClass("han-js-charized")})}});for(var feature in tests){if(classes.push((tests[feature]()?"":"no-")+feature),!tester)var tester="";tester+="    "+feature+": tests['"+feature+"'](),\n"}!function(window){eval("tester = ({\n"+tester.replace(/\n$/gi,"\nfont: test_for_fontface\n}")+")")}(),han(),window.han={unicode:unicode_set,support:tester}}(jQuery),window.findAndReplaceDOMText=function(){function findAndReplaceDOMText(regex,node,replacementNode,captureGroup,elFilter){var m,matches=[],text=_getText(node,elFilter),replaceFn=_genReplacer(replacementNode);if(text){if(regex.global)for(;m=regex.exec(text);)matches.push(_getMatchIndexes(m,captureGroup));else m=text.match(regex),matches.push(_getMatchIndexes(m,captureGroup));matches.length&&_stepThroughMatches(node,matches,replaceFn,elFilter)}}function _getMatchIndexes(m,captureGroup){if(captureGroup=captureGroup||0,!m[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var index=m.index;if(captureGroup>0){var cg=m[captureGroup];if(!cg)throw"Invalid capture group";index+=m[0].indexOf(cg),m[0]=cg}return[index,index+m[0].length,[m[0]]]}function _getText(node,elFilter){if(3===node.nodeType)return node.data;if(elFilter&&!elFilter(node))return"";var txt="";if(node=node.firstChild)do txt+=_getText(node,elFilter);while(node=node.nextSibling);return txt}function _stepThroughMatches(node,matches,replaceFn,elFilter){var startNode,endNode,startNodeIndex,endNodeIndex,doAvoidNode,innerNodes=[],atIndex=0,curNode=node,matchLocation=matches.shift(),matchIndex=0;out:for(;;){if(3===curNode.nodeType&&(!endNode&&curNode.length+atIndex>=matchLocation[1]?(endNode=curNode,endNodeIndex=matchLocation[1]-atIndex):startNode&&innerNodes.push(curNode),!startNode&&curNode.length+atIndex>matchLocation[0]&&(startNode=curNode,startNodeIndex=matchLocation[0]-atIndex),atIndex+=curNode.length),doAvoidNode=1===curNode.nodeType&&elFilter&&!elFilter(curNode),startNode&&endNode){if(curNode=replaceFn({startNode:startNode,startNodeIndex:startNodeIndex,endNode:endNode,endNodeIndex:endNodeIndex,innerNodes:innerNodes,match:matchLocation[2],matchIndex:matchIndex}),atIndex-=endNode.length-endNodeIndex,startNode=null,endNode=null,innerNodes=[],matchLocation=matches.shift(),matchIndex++,!matchLocation)break}else if(!doAvoidNode&&(curNode.firstChild||curNode.nextSibling)){curNode=curNode.firstChild||curNode.nextSibling;continue}for(;;){if(curNode.nextSibling){curNode=curNode.nextSibling;break}if(curNode.parentNode===node)break out;curNode=curNode.parentNode}}}function _genReplacer(nodeName){reverts=[];var makeReplacementNode;if("function"!=typeof nodeName){var stencilNode=nodeName.nodeType?nodeName:document.createElement(nodeName);makeReplacementNode=function(fill){var el,clone=document.createElement("div");return clone.innerHTML=stencilNode.outerHTML||(new XMLSerializer).serializeToString(stencilNode),el=clone.firstChild,fill&&el.appendChild(document.createTextNode(fill)),el}}else makeReplacementNode=nodeName;return function(range){var startNode=range.startNode,endNode=range.endNode,matchIndex=range.matchIndex;if(startNode===endNode){var node=startNode;if(range.startNodeIndex>0){var before=document.createTextNode(node.data.substring(0,range.startNodeIndex));node.parentNode.insertBefore(before,node)}var el=makeReplacementNode(range.match[0],matchIndex,range.match[0]);if(node.parentNode.insertBefore(el,node),range.endNodeIndex<node.length){var after=document.createTextNode(node.data.substring(range.endNodeIndex));node.parentNode.insertBefore(after,node)}return node.parentNode.removeChild(node),reverts.push(function(){var pnode=el.parentNode;pnode.insertBefore(el.firstChild,el),pnode.removeChild(el),pnode.normalize()}),el}for(var before=document.createTextNode(startNode.data.substring(0,range.startNodeIndex)),after=document.createTextNode(endNode.data.substring(range.endNodeIndex)),elA=makeReplacementNode(startNode.data.substring(range.startNodeIndex),matchIndex,range.match[0]),innerEls=[],i=0,l=range.innerNodes.length;l>i;++i){var innerNode=range.innerNodes[i],innerEl=makeReplacementNode(innerNode.data,matchIndex,range.match[0]);innerNode.parentNode.replaceChild(innerEl,innerNode),innerEls.push(innerEl)}var elB=makeReplacementNode(endNode.data.substring(0,range.endNodeIndex),matchIndex,range.match[0]);return startNode.parentNode.insertBefore(before,startNode),startNode.parentNode.insertBefore(elA,startNode),startNode.parentNode.removeChild(startNode),endNode.parentNode.insertBefore(elB,endNode),endNode.parentNode.insertBefore(after,endNode),endNode.parentNode.removeChild(endNode),reverts.push(function(){innerEls.unshift(elA),innerEls.push(elB);for(var i=0,l=innerEls.length;l>i;++i){var el=innerEls[i],pnode=el.parentNode;pnode.insertBefore(el.firstChild,el),pnode.removeChild(el),pnode.normalize()}}),elB}}var reverts;return findAndReplaceDOMText.revert=function(){for(var i=0,l=reverts.length;l>i;++i)reverts[i]();reverts=[]},findAndReplaceDOMText}();